import{s as h,p,a as E,b as f,l as g,d as u,g as v}from"./index-2-HCTc4e.js";import{a as y}from"./ai-BOEkcp8J.js";class I{constructor(t,s,i,e,a,l,r){this.pageId=t,this.storageKey=s,this.listId=i,this.formId=e,this.inputId=a,this.defaultGoals=l,this.categoryName=r,this.goals=[],this.listEl=null,this.formEl=null,this.inputEl=null,this.aiBtnEl=null}setup(){var s,i,e,a;const t=document.getElementById(this.pageId);t&&(this.listEl=t.querySelector(`#${this.listId}`),this.formEl=t.querySelector(`#${this.formId}`),this.inputEl=t.querySelector(`#${this.inputId}`),this.aiBtnEl=((s=this.formEl)==null?void 0:s.querySelector(".ai-suggestion-btn"))||null,(i=this.formEl)==null||i.addEventListener("submit",l=>this.handleSubmit(l)),(e=this.listEl)==null||e.addEventListener("click",l=>this.handleListClick(l)),(a=this.aiBtnEl)==null||a.addEventListener("click",()=>this.handleAiSuggestion()),this.setupDragAndDrop())}show(){const t=h.get(this.storageKey);this.goals=t&&t.length>0?t:[...this.defaultGoals],this.render()}render(){var s,i;if(!this.listEl)return;const t=(i=(s=this.listEl.querySelector(".item-edit-input"))==null?void 0:s.closest("li"))==null?void 0:i.dataset.id;if(this.listEl.innerHTML="",this.goals.length===0){this.listEl.innerHTML='<li class="empty-list-placeholder">Nenhuma meta definida.</li>';return}if(this.goals.forEach(e=>{const a=document.createElement("li");a.className=e.completed?"completed":"",a.dataset.id=e.id,a.draggable=!0,a.innerHTML=`
                <input type="checkbox" class="task-checkbox" ${e.completed?"checked":""} id="task-${e.id}" aria-label="Concluir meta">
                <label for="task-${e.id}" class="item-text">${p.sanitize(e.text)}</label>
                <div class="item-actions">
                    <button class="action-btn edit-btn edit" aria-label="Editar meta"><i class="fas fa-edit"></i></button>
                    <button class="action-btn delete-btn delete" aria-label="Apagar meta"><i class="fas fa-trash"></i></button>
                </div>
            `,this.listEl.appendChild(a)}),t){const e=this.listEl.querySelector(`li[data-id="${t}"]`);e&&this.enterEditMode(e)}}handleSubmit(t){if(t.preventDefault(),!this.inputEl)return;const s=this.inputEl.value.trim();s&&(this.addGoal(s),this.inputEl.value="")}addGoal(t){this.goals.unshift({id:Date.now().toString(),text:t,completed:!1}),this.save(),this.render()}handleListClick(t){const s=t.target,i=s.closest("li");if(!i||!i.dataset.id||i.classList.contains("editing"))return;const e=i.dataset.id,a=this.goals.findIndex(l=>l.id===e);a!==-1&&(s.closest(".edit-btn")?this.enterEditMode(i):s.closest(".delete-btn")?(this.goals.splice(a,1),this.save(),this.render()):(s.matches(".task-checkbox")||s.closest(".item-text"))&&this.toggleComplete(a,i))}toggleComplete(t,s){const i=this.goals[t],e=i.completed;i.completed=!i.completed,i.completed&&!e&&(E(s),f(this.categoryName.toLowerCase())),this.save(),this.render()}enterEditMode(t){var r,o;t.classList.add("editing"),t.draggable=!1;const s=t.querySelector(".item-text"),i=((r=this.goals.find(n=>n.id===t.dataset.id))==null?void 0:r.text)||"",e=document.createElement("input");e.type="text",e.className="item-edit-input",e.value=i,s.style.display="none";const a=t.querySelector(".task-checkbox");(o=a==null?void 0:a.parentElement)==null||o.insertBefore(e,s),e.focus();const l=()=>{const n=e.value.trim(),d=t.dataset.id;if(n&&d){const c=this.goals.find(m=>m.id===d);c&&(c.text=n,this.save())}this.render()};e.addEventListener("blur",l),e.addEventListener("keydown",n=>{n.key==="Enter"?e.blur():n.key==="Escape"&&(e.removeEventListener("blur",l),this.render())})}async handleAiSuggestion(){var t,s;if(this.inputEl){g.start("ai-goal"),(t=this.aiBtnEl)==null||t.classList.add("loading");try{const i=`Gere uma única meta curta, prática e acionável (máximo 12 palavras) relacionada à ${this.categoryName} para melhorar o bem-estar diário. Responda apenas com o texto da meta, sem aspas.`,a=(await y.models.generateContent({model:"gemini-2.5-flash",contents:i})).text.trim();a&&(this.inputEl.value=a,this.inputEl.focus(),u("Sugestão gerada! Pressione Enter para adicionar.","success"))}catch(i){console.error("Erro ao gerar sugestão:",i),u("Não foi possível gerar uma sugestão no momento.","error")}finally{g.stop("ai-goal"),(s=this.aiBtnEl)==null||s.classList.remove("loading")}}}setupDragAndDrop(){this.listEl&&(this.listEl.addEventListener("dragstart",t=>{const s=t.target;s.tagName==="LI"&&setTimeout(()=>s.classList.add("dragging"),0)}),this.listEl.addEventListener("dragend",t=>{t.target.classList.remove("dragging")}),this.listEl.addEventListener("dragover",t=>{t.preventDefault();const s=this.listEl.querySelector(".dragging");if(!s)return;const i=v(this.listEl,t.clientY);i==null?this.listEl.appendChild(s):this.listEl.insertBefore(s,i)}),this.listEl.addEventListener("drop",t=>{if(t.preventDefault(),!this.listEl.querySelector(".dragging"))return;const i=Array.from(this.listEl.querySelectorAll("li")).map(e=>e.dataset.id);this.goals.sort((e,a)=>i.indexOf(e.id)-i.indexOf(a.id)),this.save()}))}save(){h.set(this.storageKey,this.goals)}}export{I as G};
