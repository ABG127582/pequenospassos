import{c as j,e as K,s as D,S as I,t as G,p as v}from"./index-DWo9Znp-.js";let r=[],y=[],b=null,x="all",$="",h="all",u=1;const w=10;let P="checklist",M=null;const q=new Set;let L,E=null,B=null;const H={low:"Baixa",medium:"Média",high:"Alta"},e={container:null,checklistViewContainer:null,tableViewContainer:null,taskListBody:null,emptyStateMessage:null,addCategoryBtn:null,categoriesList:null,searchInput:null,filterSelect:null,checklistViewBtn:null,tableViewBtn:null,quickTaskInput:null,addTaskBtn:null,totalCountEl:null,completedCountEl:null,pendingCountEl:null,pageInfoEl:null,currentPageEl:null,totalPagesEl:null,prevPageBtn:null,nextPageBtn:null,taskModal:null,taskModalTitle:null,taskModalForm:null,taskModalCloseBtn:null,taskModalCancelBtn:null,modalTitleInput:null,modalDescriptionInput:null,modalDueDateInput:null,modalTimeInput:null,modalPrioritySelect:null,modalCategorySelect:null,categoryChartCanvas:null,chartNoData:null},T=()=>{D.set(I.TASKS_DATA,r),D.set(I.TASKS_CATEGORIES,y)},Q=()=>{r=D.get(I.TASKS_DATA)||[],y=D.get(I.TASKS_CATEGORIES)||["Física","Mental","Financeira","Familiar","Profissional","Social","Espiritual","Preventiva"]},X=t=>{var n;!e.taskModal||!e.taskModalForm||!e.taskModalTitle||!e.modalCategorySelect||(e.taskModalForm.reset(),B=document.activeElement,e.modalCategorySelect.innerHTML='<option value="">Nenhuma</option>',y.forEach(a=>{const i=document.createElement("option");i.value=a,i.textContent=a,e.modalCategorySelect.appendChild(i)}),t?(b=t.id,e.taskModalTitle.textContent="Editar Tarefa",e.modalTitleInput.value=t.title,e.modalDescriptionInput.value=t.description,e.modalDueDateInput.value=t.dueDate,e.modalTimeInput.value=t.time||"",e.modalPrioritySelect.value=t.priority,e.modalCategorySelect.value=t.category):(b=null,e.taskModalTitle.textContent="Adicionar Tarefa",e.modalPrioritySelect.value="medium"),e.taskModal.style.display="flex",(n=e.modalTitleInput)==null||n.focus(),E=G(e.taskModal),setTimeout(()=>{var a;return(a=e.taskModal)==null?void 0:a.classList.add("visible")},10))},V=()=>{e.taskModal&&(e.taskModal.classList.remove("visible"),E&&(E(),E=null),B==null||B.focus(),setTimeout(()=>{e.taskModal&&(e.taskModal.style.display="none")},300))},Y=t=>{t.preventDefault();const n=new FormData(e.taskModalForm),a={title:n.get("title"),description:n.get("description"),dueDate:n.get("dueDate"),time:n.get("time")||void 0,priority:n.get("priority"),category:n.get("category")};if(!a.title||a.title.trim()===""){window.showToast("O título da tarefa é obrigatório.","warning");return}if(b){const i=r.findIndex(l=>l.id===b);i>-1&&(r[i]={...r[i],...a})}else{const i={id:Date.now().toString(),completed:!1,...a};r.unshift(i)}T(),p(),V(),window.showToast(`Tarefa ${b?"atualizada":"adicionada"} com sucesso!`,"success")},J=()=>{if(!e.categoryChartCanvas||!e.chartNoData)return;const t=window.Chart;if(!t)return;M&&M.destroy();const n={};r.forEach(c=>{const d=c.category||"Sem Categoria";n[d]=(n[d]||0)+1});const a=Object.keys(n),i=Object.values(n);if(r.length===0||a.length===0||i.every(c=>c===0)){e.categoryChartCanvas.style.display="none",e.chartNoData.style.display="block",e.chartNoData.textContent="Sem dados para exibir no gráfico.";return}e.categoryChartCanvas.style.display="block",e.chartNoData.style.display="none";const l=e.categoryChartCanvas.getContext("2d");if(!l)return;const o=["#4e73df","#1cc88a","#36b9cc","#f6c23e","#e74a3b","#858796","#5a5c69","#f8f9fc","#6f42c1","#fd7e14"],s=a.map((c,d)=>o[d%o.length]);M=new t(l,{type:"doughnut",data:{labels:a,datasets:[{data:i,backgroundColor:s,hoverBackgroundColor:s.map(c=>`${c}E6`),hoverBorderColor:"rgba(234, 236, 244, 1)"}]},options:{maintainAspectRatio:!1,responsive:!0,plugins:{legend:{display:!0,position:"right"},tooltip:{callbacks:{label:function(c){let d=c.label||"";if(d&&(d+=": "),c.parsed!==null){const m=c.dataset.data.reduce((C,S)=>C+S,0),k=m>0?(c.parsed/m*100).toFixed(1):0;d+=`${c.raw} (${k}%)`}return d}}}},cutout:"80%"}})},p=()=>{const t=R();W(),_(),Z(t);const n=U(t);e.checklistViewContainer&&e.tableViewContainer&&(P==="checklist"?(te(n),e.checklistViewContainer.style.display="flex",e.tableViewContainer.style.display="none"):(ee(n),e.checklistViewContainer.style.display="none",e.tableViewContainer.style.display="block")),e.emptyStateMessage&&(e.emptyStateMessage.style.display=t.length===0?"block":"none"),J()},R=()=>{let t=[...r];if(h!=="all"&&(t=t.filter(a=>a.category===h)),$){const a=$.toLowerCase();t=t.filter(i=>i.title.toLowerCase().includes(a)||i.description.toLowerCase().includes(a))}const n=new Date().toISOString().split("T")[0];switch(x){case"pending":t=t.filter(a=>!a.completed);break;case"completed":t=t.filter(a=>a.completed);break;case"overdue":t=t.filter(a=>!a.completed&&a.dueDate&&a.dueDate<n);break;case"high":case"medium":case"low":t=t.filter(a=>a.priority===x);break}return t.sort((a,i)=>(a.dueDate||"9999").localeCompare(i.dueDate||"9999"))},U=t=>{const n=(u-1)*w;return t.slice(n,n+w)},W=()=>{if(!e.totalCountEl||!e.completedCountEl||!e.pendingCountEl)return;const t=r.length,n=r.filter(a=>a.completed).length;e.totalCountEl.textContent=t.toString(),e.completedCountEl.textContent=n.toString(),e.pendingCountEl.textContent=(t-n).toString()},_=()=>{if(!e.categoriesList||!e.addCategoryBtn)return;e.categoriesList.innerHTML="",e.categoriesList.appendChild(e.addCategoryBtn);const t=document.createElement("button");t.className=`category-tag ${h==="all"?"active":""}`,t.textContent="Todas",t.dataset.category="all",e.categoriesList.prepend(t),y.forEach(n=>{const a=document.createElement("button");a.className=`category-tag ${h===n?"active":""}`,a.textContent=n,a.dataset.category=n,e.categoriesList.appendChild(a)})},Z=t=>{if(!e.pageInfoEl||!e.currentPageEl||!e.totalPagesEl||!e.prevPageBtn||!e.nextPageBtn)return;const n=t.length,a=Math.ceil(n/w)||1;e.pageInfoEl.textContent=`Mostrando ${Math.min((u-1)*w+1,n)}-${Math.min(u*w,n)} de ${n}`,e.currentPageEl.textContent=u.toString(),e.totalPagesEl.textContent=a.toString(),e.prevPageBtn.disabled=u===1,e.nextPageBtn.disabled=u===a},ee=t=>{if(!e.taskListBody)return;e.taskListBody.innerHTML="";const n=new Date().toISOString().split("T")[0];t.forEach(a=>{const i=document.createElement("tr");i.className=a.completed?"completed":"",i.dataset.taskId=a.id;const l=!a.completed&&a.dueDate&&a.dueDate<n,o=a.dueDate?new Date(a.dueDate+"T00:00:00").toLocaleDateString("pt-BR"):"Sem data",s=H[a.priority]||"Média",c=a.time?`<span class="item-time"><i class="fas fa-clock"></i> ${a.time}</span>`:"";i.innerHTML=`
            <td><input type="checkbox" class="task-checkbox" ${a.completed?"checked":""} aria-label="Marcar tarefa como concluída"></td>
            <td>
                <span class="task-title">${v.sanitize(a.title)}</span>
                <span class="task-description-preview">${v.sanitize(a.description)}</span>
            </td>
            <td style="${l?"color: var(--color-error); font-weight: bold;":""}">${o} ${c}</td>
            <td><span class="priority-tag priority-${a.priority}">${s}</span></td>
            <td>${a.category?`<span class="task-category-badge">${v.sanitize(a.category)}</span>`:""}</td>
            <td class="task-actions-cell">
                <button class="action-btn edit" aria-label="Editar tarefa"><i class="fas fa-edit"></i></button>
                <button class="action-btn delete" aria-label="Excluir tarefa"><i class="fas fa-trash"></i></button>
            </td>
        `,e.taskListBody.appendChild(i)})},te=t=>{if(!e.checklistViewContainer)return;e.checklistViewContainer.innerHTML="";const n={};t.forEach(i=>{const l=i.category||"Sem Categoria";n[l]||(n[l]=[]),n[l].push(i)}),["all",...y,"Sem Categoria"].filter(i=>i!=="all").forEach(i=>{if(n[i]&&n[i].length>0){const l=document.createElement("div");l.className="checklist-category-group",l.innerHTML=`<h3 class="checklist-category-title">${v.sanitize(i)}</h3>`,n[i].forEach(o=>{const s=document.createElement("div"),c=!o.completed&&o.dueDate&&o.dueDate<new Date().toISOString().split("T")[0];s.className=`checklist-item ${o.completed?"completed":""} ${c?"overdue":""}`,s.dataset.taskId=o.id;const d=H[o.priority],m=`<div class="priority-dot priority-dot-${o.priority}"></div> ${d}`,k=o.dueDate?`<i class="fas fa-calendar-alt"></i> ${new Date(o.dueDate+"T00:00:00").toLocaleDateString("pt-BR")}`:"",C=o.time?`<span class="checklist-item-time"><i class="fas fa-clock"></i> ${o.time}</span>`:"";s.innerHTML=`
                    <div class="checklist-item-main">
                        <input type="checkbox" class="checklist-item-checkbox task-checkbox" ${o.completed?"checked":""} aria-label="Marcar tarefa como concluída">
                        <div class="checklist-item-content">
                            <div class="checklist-item-summary">
                                <span class="checklist-item-title">${v.sanitize(o.title)}</span>
                                <button class="action-btn toggle-details" aria-label="Alternar detalhes" aria-expanded="false"><i class="fas fa-chevron-down"></i></button>
                            </div>
                            <div class="checklist-item-full-details">
                                <div class="details-inner-wrapper">
                                    <p class="checklist-item-description">${o.description?v.sanitize(o.description).replace(/\n/g,"<br>"):"<i>Sem descrição.</i>"}</p>
                                    <div class="checklist-item-meta">
                                        <div class="checklist-item-priority">${m}</div>
                                        <div class="checklist-item-date">${k}</div>
                                        ${C}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="checklist-item-actions">
                        <button class="action-btn edit" aria-label="Editar tarefa"><i class="fas fa-edit"></i></button>
                        <button class="action-btn delete" aria-label="Excluir tarefa"><i class="fas fa-trash"></i></button>
                    </div>
                `,l.appendChild(s)}),e.checklistViewContainer.appendChild(l)}})},N=async t=>{const n=t.target,a=n.closest("[data-task-id]");if(!a)return;if(n.closest(".toggle-details")||n.closest(".checklist-item-summary")){const o=a.classList.toggle("details-expanded"),s=a.querySelector(".toggle-details");s&&s.setAttribute("aria-expanded",String(o));return}const i=a.dataset.taskId,l=r.find(o=>o.id===i);if(l){if(n.closest(".delete"))await j(`Tem certeza que deseja excluir a tarefa "${l.title}"?`)&&(r=r.filter(s=>s.id!==i),T(),p(),window.showToast("Tarefa excluída.","success"));else if(n.closest(".edit"))X(l);else if(n.matches(".task-checkbox, .task-checkbox *")){if(l.completed=!l.completed,l.completed&&window.gamification){const s={high:30,medium:20,low:10}[l.priority]||10;window.gamification.addXP(s)}T(),p()}}},z=()=>{const t=e.quickTaskInput.value.trim();if(t){const n={id:Date.now().toString(),title:t,description:"",dueDate:"",priority:"medium",category:h!=="all"?h:"",completed:!1};r.unshift(n),T(),p(),e.quickTaskInput.value="",window.showToast("Tarefa rápida adicionada!","success")}},ae=async t=>{const n=t.target;if(n.id==="add-category-btn"){const a=prompt("Digite o nome da nova categoria:");a&&a.trim()!==""&&(y.includes(a)?window.showToast("Essa categoria já existe.","warning"):(y.push(a),T(),_(),window.showToast("Categoria adicionada!","success")))}else n.classList.contains("category-tag")&&(h=n.dataset.category||"all",u=1,p())},ne=()=>{const t=new Date,n=t.toISOString().split("T")[0],a=t.toTimeString().substring(0,5);r.forEach(i=>{i.dueDate===n&&i.time===a&&!i.completed&&!q.has(i.id)&&(window.showToast(`Lembrete de tarefa: "${i.title}"`,"info"),q.add(i.id))})},ie=()=>{L&&window.clearInterval(L),q.clear(),L=window.setInterval(ne,6e4)};function le(){var a,i,l,o,s,c,d,m,k,C,S,A,F,O;const t=document.getElementById("page-tarefas");if(!t){console.error("Tarefas page container (#page-tarefas) not found.");return}e.container=t,e.checklistViewContainer=t.querySelector("#checklist-view-container"),e.tableViewContainer=t.querySelector(".table-wrapper"),e.taskListBody=t.querySelector("#task-list"),e.emptyStateMessage=t.querySelector("#empty-state-message"),e.addCategoryBtn=t.querySelector("#add-category-btn"),e.categoriesList=t.querySelector("#categories-list"),e.searchInput=t.querySelector("#search-input"),e.filterSelect=t.querySelector("#filter-select"),e.checklistViewBtn=t.querySelector("#checklist-view-btn"),e.tableViewBtn=t.querySelector("#table-view-btn"),e.quickTaskInput=t.querySelector("#quick-task-input"),e.addTaskBtn=t.querySelector("#add-task-btn"),e.totalCountEl=t.querySelector("#total-count"),e.completedCountEl=t.querySelector("#completed-count"),e.pendingCountEl=t.querySelector("#pending-count"),e.pageInfoEl=t.querySelector(".page-info"),e.currentPageEl=t.querySelector("#current-page"),e.totalPagesEl=t.querySelector("#total-pages"),e.prevPageBtn=t.querySelector("#prev-page-btn"),e.nextPageBtn=t.querySelector("#next-page-btn"),e.categoryChartCanvas=t.querySelector("#category-chart"),e.chartNoData=t.querySelector("#chart-no-data"),e.taskModal=document.getElementById("task-modal-gerenciar-tarefas"),e.taskModalTitle=document.getElementById("modal-title-tarefas"),e.taskModalForm=document.getElementById("task-form-gerenciar-tarefas"),e.taskModalCloseBtn=document.getElementById("task-modal-close-btn"),e.taskModalCancelBtn=document.getElementById("cancel-task-btn-gerenciar-tarefas"),e.modalTitleInput=document.getElementById("modal-task-title"),e.modalDescriptionInput=document.getElementById("modal-task-description"),e.modalDueDateInput=document.getElementById("modal-task-due-date"),e.modalTimeInput=document.getElementById("modal-task-time"),e.modalPrioritySelect=document.getElementById("modal-task-priority"),e.modalCategorySelect=document.getElementById("modal-task-category");for(const[g,f]of Object.entries(e))f===null&&console.warn(`Tarefas page element not found for key: ${g}`);(a=e.addTaskBtn)==null||a.addEventListener("click",z),(i=e.quickTaskInput)==null||i.addEventListener("keypress",g=>{g.key==="Enter"&&z()}),(l=e.checklistViewContainer)==null||l.addEventListener("click",N),(o=e.taskListBody)==null||o.addEventListener("click",N),e.taskModal&&!e.taskModal.dataset.handlerAttached&&((s=e.taskModalCloseBtn)==null||s.addEventListener("click",V),(c=e.taskModalCancelBtn)==null||c.addEventListener("click",V),(d=e.taskModalForm)==null||d.addEventListener("submit",Y),e.taskModal.dataset.handlerAttached="true");const n=K(()=>{u=1,p()},300);(m=e.searchInput)==null||m.addEventListener("input",()=>{$=e.searchInput.value,n()}),(k=e.filterSelect)==null||k.addEventListener("change",()=>{x=e.filterSelect.value,u=1,p()}),(C=e.categoriesList)==null||C.addEventListener("click",ae),(S=e.prevPageBtn)==null||S.addEventListener("click",()=>{u>1&&(u--,p())}),(A=e.nextPageBtn)==null||A.addEventListener("click",()=>{const g=Math.ceil(R().length/w)||1;u<g&&(u++,p())}),(F=e.checklistViewBtn)==null||F.addEventListener("click",()=>{var g,f;P="checklist",(g=e.checklistViewBtn)==null||g.classList.add("active"),(f=e.tableViewBtn)==null||f.classList.remove("active"),p()}),(O=e.tableViewBtn)==null||O.addEventListener("click",()=>{var g,f;P="table",(g=e.tableViewBtn)==null||g.classList.add("active"),(f=e.checklistViewBtn)==null||f.classList.remove("active"),p()}),ie()}function se(){e.container&&(Q(),p())}export{le as setup,se as show};
