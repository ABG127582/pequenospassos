import{e as I,c as b,s as y,S as v,l as p,p as f}from"./main-sp5dYjpB.js";import{a as E}from"./ai-BOEkcp8J.js";const w={Física:{name:"Física",color:"var(--color-fisica)"},Mental:{name:"Mental",color:"var(--color-mental)"},Financeira:{name:"Financeira",color:"var(--color-financeira)"},Familiar:{name:"Familiar",color:"var(--color-familiar)"},Profissional:{name:"Profissional",color:"var(--color-profissional)"},Social:{name:"Social",color:"var(--color-social)"},Espiritual:{name:"Espiritual",color:"var(--color-espiritual)"}};let d=[],g=[],t;function l(e,i){const n=i.querySelector(e);if(!n)throw new Error(`Element not found: ${e}`);return n}function B(e){return new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}function L(e){return e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br>").replace(/<br>\s*-\s/g,"<br>&#8226; ").replace(/<br>\s*\*\s/g,"<br>&#8226; ")}function c(){R();const e=document.createDocumentFragment();g.length===0?(t.emptyState.style.display="block",t.listContainer.innerHTML="",t.generateInsightsBtn.disabled=!0):(t.emptyState.style.display="none",t.generateInsightsBtn.disabled=!1,g.forEach(i=>{e.appendChild(x(i))}),t.listContainer.replaceChildren(e))}function x(e){const i=w[e.category]||{name:e.category,color:"var(--color-secondary)"},n=B(e.timestamp),s=document.createElement("div");return s.className="reflection-card-item",s.style.borderLeftColor=i.color,s.dataset.id=e.id,s.innerHTML=`
        <div class="reflection-card-header">
            <span class="reflection-card-category" style="background-color: ${i.color};">${f.sanitize(i.name)}</span>
            <span class="reflection-card-date">${n}</span>
        </div>
        <div class="reflection-card-body">
            <strong class="reflection-title">${f.sanitize(e.title)}</strong>
            <p>${f.sanitize(e.text).replace(/\n/g,"<br>")}</p>
        </div>
        <div class="reflection-card-actions">
            <button class="action-btn delete-reflection-btn delete" aria-label="Excluir reflexão"><i class="fas fa-trash"></i></button>
        </div>
    `,s}function F(){t.categoryFilter.innerHTML='<option value="all">Todas</option>',Object.values(w).forEach(e=>{const i=document.createElement("option");i.value=e.name,i.textContent=e.name,t.categoryFilter.appendChild(i)})}function C(e){t.aiInsightsBody.innerHTML=L(f.sanitize(e)),t.aiInsightsModal.style.display="flex"}function h(){t.aiInsightsModal.style.display="none"}async function T(){if(g.length===0){window.showToast("Não há reflexões para analisar. Altere os filtros ou adicione novas reflexões.","info");return}p.start("ai-insights"),t.generateInsightsBtn.classList.add("loading"),t.generateInsightsBtn.disabled=!0;const i=`Aja como um psicólogo compassivo e analista de padrões. Analise as seguintes entradas de diário de um usuário. Identifique temas recorrentes, padrões emocionais, áreas de força e potenciais áreas para crescimento. Apresente suas percepções em uma lista de marcadores (usando '*') concisa e encorajadora. As entradas são:

${g.map(n=>`Data: ${n.date}
Título: ${n.title}
Categoria: ${n.category}
Reflexão: ${n.text}`).join(`

---

`)}`;try{const s=(await E.models.generateContent({model:"gemini-2.5-flash",contents:i})).text;C(s)}catch(n){console.error("Gemini API error:",n),window.showToast("Ocorreu um erro ao gerar os insights. Por favor, tente novamente.","error")}finally{p.stop("ai-insights"),t.generateInsightsBtn.classList.remove("loading"),t.generateInsightsBtn.disabled=!1}}function k(){d=y.get(v.UNIFIED_REFLECTIONS)||[]}function R(){const e=t.searchInput.value.toLowerCase(),i=t.categoryFilter.value,n=t.dateFilter.value,s=t.sortFilter.value;let r=[...d];if(e&&(r=r.filter(a=>a.text.toLowerCase().includes(e)||a.title.toLowerCase().includes(e))),i!=="all"&&(r=r.filter(a=>a.category===i)),n!=="all"){const a=new Date;a.setHours(23,59,59,999);let o;switch(n){case"today":const m=new Date;m.setHours(0,0,0,0),o=m.getTime();break;case"week":o=a.getTime()-7*24*60*60*1e3;break;case"month":o=a.getTime()-30*24*60*60*1e3;break;default:o=0}r=r.filter(m=>m.timestamp>=o)}r.sort((a,o)=>s==="desc"?o.timestamp-a.timestamp:a.timestamp-o.timestamp),g=r}async function M(e){const n=e.target.closest(".delete-reflection-btn");if(!n)return;const s=n.closest(".reflection-card-item");if(!(s!=null&&s.dataset.id))return;const r=s.dataset.id;await b("Tem certeza que deseja excluir esta reflexão? Esta ação não pode ser desfeita.")&&(d=d.filter(o=>o.id!==r),y.set(v.UNIFIED_REFLECTIONS,d),window.showToast("Reflexão excluída com sucesso.","success"),c())}function u(e){e==="grid"?(t.listContainer.classList.add("grid-view"),t.gridViewBtn.classList.add("active"),t.listViewBtn.classList.remove("active"),t.gridViewBtn.setAttribute("aria-pressed","true"),t.listViewBtn.setAttribute("aria-pressed","false")):(t.listContainer.classList.remove("grid-view"),t.listViewBtn.classList.add("active"),t.gridViewBtn.classList.remove("active"),t.listViewBtn.setAttribute("aria-pressed","true"),t.gridViewBtn.setAttribute("aria-pressed","false"))}function S(e){t={page:e,searchInput:l("#reflexoes-search-input",e),categoryFilter:l("#reflexoes-category-filter",e),dateFilter:l("#reflexoes-date-filter",e),sortFilter:l("#reflexoes-sort-filter",e),listViewBtn:l("#list-view-btn",e),gridViewBtn:l("#grid-view-btn",e),listContainer:l("#reflexoes-list-container",e),emptyState:l("#reflexoes-empty-state",e),generateInsightsBtn:l("#generate-insights-btn",e),aiInsightsModal:document.getElementById("ai-insights-modal"),aiInsightsBody:document.getElementById("ai-insights-body"),aiInsightsCloseBtn:document.getElementById("ai-insights-close-btn"),aiInsightsOkBtn:document.getElementById("ai-insights-ok-btn"),aiInsightsCopyBtn:document.getElementById("ai-insights-copy-btn")}}function $(){const e=document.getElementById("page-reflexoes-diarias");if(!e){console.warn("Página de reflexões não encontrada durante o setup.");return}S(e);const i=I(c,300);t.searchInput.addEventListener("input",i),t.categoryFilter.addEventListener("change",c),t.dateFilter.addEventListener("change",c),t.sortFilter.addEventListener("change",c),t.listContainer.addEventListener("click",M),t.listViewBtn.addEventListener("click",()=>u("list")),t.gridViewBtn.addEventListener("click",()=>u("grid")),t.generateInsightsBtn.addEventListener("click",T),t.aiInsightsCloseBtn.addEventListener("click",h),t.aiInsightsOkBtn.addEventListener("click",h),t.aiInsightsCopyBtn.addEventListener("click",()=>{navigator.clipboard.writeText(t.aiInsightsBody.innerText).then(()=>window.showToast("Insights copiados para a área de transferência!","success")).catch(()=>window.showToast("Falha ao copiar texto.","error"))}),F()}function D(){!t||!t.page||(k(),c(),u("list"))}export{$ as setup,D as show};
